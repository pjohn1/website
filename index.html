<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phillip Johnson Profile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        #game {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background-color: burlywood;
            background-size: 64px 64px;
        }
        .sprite {
            transform: translate(-50%, -50%);
        }
        #toolbox {
            position: absolute;
            width: 10vw;
            height: 20vh;
            background-color: transparent; 
            top: 50px;
            right: 25%;
            background-image: url('toolbox.png');
            background-size: cover;
        }
        #chest {
            position: absolute;
            width: 10vw;
            height: 20vh;
            background-color: transparent; 
            bottom: 50px;
            left: 20%;
            background-image: url('chest.png');
            background-size: cover;
        }
        .button {
            bottom: 0%;
            right: 0%;
        }
        #internships {
            right: 5%;
            top: 50%;
        }
        #research {
            left: 5%;
            top: 50%;
        }
        #projects{
            top: 5%;
            right: 50%;
        }
        #leadership{
            bottom: 5%;
            right: 50%
        }
    </style>
</head>
<body>

    <div id="game">
        <div id="player" class="sprite"></div>
        <div id="internships" class="portal" data-url="internships.html">
            <p class="portal-text"> Internships </p>
        </div>
        <div id="research" class="portal" data-url="research.html">
            <p class="portal-text"> Research </p>
        </div>
        <div id="projects" class="portal" data-url="projects.html">
            <p class="portal-text"> Projects </p>
        </div>
        <div id="leadership" class="portal" data-url="leadership.html">
            <p class="portal-text"> Leadership </p>
        </div>
        <div id="toolbox" data-url="#toolbox"></div>
        <div id="chest" data-url="#chest"></div>

        <div id="settings-menu" class="settings-menu">
            <h3>Menu</h3>
            <p><b>Controls:</b> Use WASD or Arrow Keys to move or simply click on portals to teleport</p>
            <label>
                Adjust player speed: <input type="number" value=2 id="player-speed">
                <button id="submit-speed" onclick="saveValue()">Submit</button>
            </label>
            <p></p>
            <button id="close-settings" class="settings-button">X</button>
        </div>
        
        <button id="settings-button" class="settings-button">⚙️</button>
        
    </div>

    <script>
        // window.addEventListener('load', () => {
        //     localStorage.clear();
        // });

        function saveValue() {
            const value = document.getElementById('player-speed').value;
            localStorage.setItem('playerSpeed', value);
            console.log('saved player speed');
        }

        let playerSpeed= parseFloat(localStorage.getItem('playerSpeed')) || 2;
        button_value = document.getElementById('player-speed')
        button_value.value = playerSpeed;

        // Player movement logic with continuous movement and smooth scrolling background
        const player = document.getElementById('player');
        const game = document.getElementById('game');
        const clickableDivs = document.querySelectorAll('[data-url]');

        let playerX = game.clientWidth / 2 - player.clientWidth / 2;
        let playerY = game.clientHeight / 2 - player.clientHeight / 2;
        let keysPressed = {};

        document.addEventListener('DOMContentLoaded', function () {
            const settingsMenu = document.getElementById('settings-menu');
            const settingsButton = document.getElementById('settings-button');
            const closeSettingsButton = document.getElementById('close-settings');
            
            // Check if it's the first load
            const firstLoad = !localStorage.getItem('settingsOpened');
            // console.log(firstLoad);
            
            // Automatically open on first load
            if (firstLoad) {
                settingsMenu.style.display = 'block';
                localStorage.setItem('settingsOpened', true); // Set it so it won't auto-open again
            }

            // Toggle settings menu visibility on button click
            settingsButton.addEventListener('click', function () {
                settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
            });

            // Close settings menu when close button is clicked
            closeSettingsButton.addEventListener('click', function () {
                settingsMenu.style.display = 'none';
            });
        });

        // Track key presses
        document.addEventListener('keydown', function (event) {
            keysPressed[event.key] = true;
        });

        document.addEventListener('keyup', function (event) {
            keysPressed[event.key] = false;
        });

        function movePlayer() {
            playerSpeed= parseFloat(localStorage.getItem('playerSpeed')) || 2;
            if (keysPressed['w'] || keysPressed['ArrowUp']) playerY -= playerSpeed;
            if (keysPressed['s'] || keysPressed['ArrowDown']) playerY += playerSpeed;
            if (keysPressed['a'] || keysPressed['ArrowLeft']) playerX -= playerSpeed;
            if (keysPressed['d'] || keysPressed['ArrowRight']) playerX += playerSpeed;

            // Update player position
            player.style.top = playerY + 'px';
            player.style.left = playerX + 'px';

            // Update the background to scroll with the player
            game.style.backgroundPositionX = `${-playerX / 2}px`;
            game.style.backgroundPositionY = `${-playerY / 2}px`;

            checkPortals();
        }

        function checkPortals() {
            const portals = document.querySelectorAll('.portal');
            portals.forEach(portal => {
                const portalRect = portal.getBoundingClientRect();
                const playerRect = player.getBoundingClientRect();

                if (
                    playerRect.left < portalRect.right &&
                    playerRect.right > portalRect.left &&
                    playerRect.top < portalRect.bottom &&
                    playerRect.bottom > portalRect.top
                ) {
                    window.location.href = portal.dataset.url; // Navigate to the next page
                }
            });
        }

        // Continuously move the player and update the game
        function gameLoop() {
            movePlayer();
            requestAnimationFrame(gameLoop);
        }

        clickableDivs.forEach(div => {
            div.addEventListener('click', function() {
                const url = div.getAttribute('data-url'); // Get the URL from the data-url attribute
                if (url) {
                    window.location.href = url; // Redirect to the URL
                }
            });
        });

        // Start the game loop
        gameLoop();
    </script>

</body>
</html>
