<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Phillip Johnson Profile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background-image: url('leadership_back.png');
            background-size: contain;
            background-repeat: repeat;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }
        #game {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background-image: url('leadership_background.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-attachment: fixed;
            z-index: 1;
        }
        .sprite {
            bottom: 10%;
            left: 0%;
            transform: translate(-1000%,0%);
        }
        .textdiv {
            visibility: hidden;
            width: 50vw;
            height: 42vh;
            left: 0;
            top: 0;
            backdrop-filter: blur(10px);
            transform: translate(0%,-70%);
            background-size: cover;
        }

        .settings-menu {
            left:0%;
            bottom:50%;
        }
        .settings-button {
            position:absolute;
            top:0%;
            right:0%;
            z-index: 101;
            cursor: pointer;
        }

        .portal {
            bottom: 40vh;
            left: 0vw;
            z-index: 100;
        }

        #ball {
            position: absolute;
            width: 50px;
            height: 50px;
            background-image: url('volleyball.png');
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 4;
        }
        #volleyball {
            background-color: transparent;
            z-index: 2;
        }
        #tt {
            background-color: transparent;
            transform: translate(-100%,-70%);
            z-index: 3;
        }
    </style>
</head>
<body>

    <div id="settings-menu" class="settings-menu">
        <h3>Menu</h3>
        <p><b>Controls:</b> Use WASD or Arrow Keys to move and space bar to jump</p>
        <p></p>
        <button id="close-settings" class="settings-button">X</button>
    </div>

    <button id="settings-button1" class="settings-button">⚙️</button>
    

    <div id="volleyball" class="textdiv">
        <h1 class="text">MIT Men's Varsity Volleyball Captain</h1>
        <ol class="lists">
            <li>Promoted team cohesion and maintained a constructive team culture</li>
            <li>Addressed players and staff concerns and took necessary action </li>
        </ol>
    </div>
    <div id="tt" class="textdiv">
        <h1 class="text">Theta Tau Professional Engineering Society Social Chair</h1>
        <ol class="lists">
            <li>Organized all social events including a 65-person formal event with food, lodging, and transportation</li>
            <li>Coordinated with other event planners and promote communication between organizations </li>
        </ol>
    </div>
    <div id="game">
        <div id="player" class="sprite"></div>
        <div class="portal" data-url="index.html"></div>
        <div id="ball"></div> <!-- New ball element -->
    </div>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const settingsMenu = document.getElementById('settings-menu');
            const settingsButton = document.getElementById('settings-button1');
            const closeSettingsButton = document.getElementById('close-settings');
            
            // Check if it's the first load
            const firstLoad = !localStorage.getItem('settingsOpened');
            // console.log(firstLoad);
            
            // Automatically open on first load
            if (firstLoad) {
                settingsMenu.style.display = 'block';
                localStorage.setItem('settingsOpened', true); // Set it so it won't auto-open again
            }

            // Toggle settings menu visibility on button click
            settingsButton.addEventListener('click', function () {
                settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
            });

            // Close settings menu when close button is clicked
            closeSettingsButton.addEventListener('click', function () {
                settingsMenu.style.display = 'none';
            });
        });

        const player = document.getElementById('player');
        const game = document.getElementById('game');
        const ball = document.getElementById('ball');
        const portal = document.querySelector('.portal');
        const vball = document.getElementById('volleyball');
        const tt = document.getElementById('tt')
        const clickableDivs = document.querySelectorAll('[data-url]');
        const ballFriction = 0.99;  // Friction to gradually reduce speed
        const bounceFactor = 1.2;  // Bounce factor to reduce velocity after bouncing

        let playerX = game.clientWidth / 2 - player.clientWidth / 2;
        let playerY = game.clientHeight / 2 - player.clientHeight / 2;
        let ballX = game.clientWidth / 2 - ball.clientWidth / 2;
        let ballY = game.clientHeight / 2 - ball.clientHeight / 2;
        let ballVelX = 0; // Ball velocity in X direction
        let ballVelY = 0; // Ball velocity in Y direction
        let keysPressed = {};

        
        // Track key presses
        document.addEventListener('keydown', function (event) {
            keysPressed[event.key] = true;
        });

        document.addEventListener('keyup', function (event) {
            keysPressed[event.key] = false;
        });

        function movePlayer() {
            let playerSpeed= parseFloat(localStorage.getItem('playerSpeed')) || 2;
            if (keysPressed['w'] || keysPressed['ArrowUp']) playerY -= playerSpeed;
            if (keysPressed['s'] || keysPressed['ArrowDown']) playerY += playerSpeed;
            if (keysPressed['a'] || keysPressed['ArrowLeft']) playerX -= playerSpeed;
            if (keysPressed['d'] || keysPressed['ArrowRight']) playerX += playerSpeed;

            // Update player position
            player.style.top = playerY + 'px';
            player.style.left = playerX + 'px';

            checkPortals();
            applyBallPhysics();
        }
        function checkBall() {
            gameRect = game.getBoundingClientRect();
            ballRect = ball.getBoundingClientRect();
            if (ballRect.left < gameRect.right/2)
            {
            vball.style.visibility = 'visible';
            tt.style.visibility = 'hidden';
            }
            else if (ballRect.left > gameRect.right/2)
            {
            vball.style.visibility = 'hidden';
            tt.style.visibility = 'visible';
            }
        }

        function checkPortals() {
            const portalRect = portal.getBoundingClientRect();
            const playerRect = player.getBoundingClientRect();

            if (
                playerRect.left < portalRect.right &&
                playerRect.right > portalRect.left &&
                playerRect.top < portalRect.bottom &&
                playerRect.bottom > portalRect.top
            ) {
                window.location.href = portal.dataset.url; // Navigate to the next page
            }
        }

        function applyBallPhysics() {
            const ballRect = ball.getBoundingClientRect();
            const playerRect = player.getBoundingClientRect();

            // Check collision between player and ball
            if (
                playerRect.left < ballRect.right &&
                playerRect.right > ballRect.left &&
                playerRect.top < ballRect.bottom &&
                playerRect.bottom > ballRect.top
            ) {
                // Push the ball slightly in the direction of the player's movement
                if (keysPressed['w']) ballVelY -= 2;
                if (keysPressed['s']) ballVelY += 2;
                if (keysPressed['a']) ballVelX -= 2;
                if (keysPressed['d']) ballVelX += 2;
            }

            // Apply velocity to the ball
            ballX += ballVelX;
            ballY += ballVelY;

            // Apply friction to slow the ball down
            ballVelX *= ballFriction;
            ballVelY *= ballFriction;

            // Check for boundaries and make the ball bounce
            if (ballX <= 0 || ballX + ball.clientWidth >= game.clientWidth) {
                ballVelX = -ballVelX * bounceFactor;  // Reverse velocity and apply bounce factor
                ballX = Math.max(0, Math.min(ballX, game.clientWidth - ball.clientWidth));
            }
            if (ballY <= 0 || ballY + ball.clientHeight >= game.clientHeight) {
                ballVelY = -ballVelY * bounceFactor;  // Reverse velocity and apply bounce factor
                ballY = Math.max(0, Math.min(ballY, game.clientHeight - ball.clientHeight));
            }

            // Update ball position
            ball.style.left = ballX + 'px';
            ball.style.top = ballY + 'px';
        }

        // Continuously move the player and update the game
        function gameLoop() {
            movePlayer();
            checkBall();
            requestAnimationFrame(gameLoop);
        }

        clickableDivs.forEach(div => {
            div.addEventListener('click', function() {
                const url = div.getAttribute('data-url'); // Get the URL from the data-url attribute
                if (url) {
                    window.location.href = url; // Redirect to the URL
                }
            });
        });

        // Start the game loop
        gameLoop();
    </script>

</body>
</html>
